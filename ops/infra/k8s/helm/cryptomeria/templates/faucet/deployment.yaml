{{- if .Values.faucet.enabled }}
apiVersion: apps/v1
kind: Deployment
metadata:
  name: faucet
  namespace: {{ .Values.global.namespace }}
  labels:
    app: faucet
spec:
  replicas: 1
  selector:
    matchLabels:
      app: faucet
  template:
    metadata:
      labels:
        app: faucet
    spec:
      containers:
        - name: faucet
          image: node:20-alpine
          imagePullPolicy: IfNotPresent
          workingDir: /app
          command: ["/bin/sh", "-c"]
          args:
            - |
              echo "ðŸš€ Setting up Faucet from ConfigMap..." && \
              # â†“â†“â†“ ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã‚’è¿½åŠ  â†“â†“â†“
              apk add --no-cache python3 make g++ && \
              # â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘
              mkdir -p /app/db && \
              cp /src/* /app/ && \
              echo "ðŸ”‘ Injecting mnemonic..." && \
              sed -i "s/MNEMONIC_PLACEHOLDER/$MNEMONIC/g" /app/config.js && \
              echo "ðŸ“¦ Installing dependencies..." && \
              npm install --quiet && \
              echo "âœ… Starting Faucet..." && \
              npm start
          ports:
            - containerPort: 4500
          env:
            - name: MNEMONIC
              valueFrom:
                secretKeyRef:
                  name: cryptomeria-mnemonics
                  key: gwc.local-admin.mnemonic
          volumeMounts:
            - name: src-volume
              mountPath: /src
      volumes:
        - name: src-volume
          configMap:
            name: faucet-source
{{- end }}