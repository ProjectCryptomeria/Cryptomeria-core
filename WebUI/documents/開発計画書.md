# ğŸš€ RaidChain WebUI é–‹ç™ºè¨ˆç”»æ›¸

ã“ã®è¨ˆç”»ã¯ã€è¦ä»¶å®šç¾©æ›¸ã®æ©Ÿèƒ½ç¾¤ã‚’ä¾å­˜é–¢ä¿‚ã®ä½ã„é †ã«å®Ÿè£…ã—ã€æ®µéšçš„ã«ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Œæˆã•ã›ã‚‹ãƒ•ãƒ­ãƒ¼ã«ãªã£ã¦ã„ã¾ã™ã€‚

## ğŸ“‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

Devcontainerå†…ã§ã™ãã«é–‹ç™ºã‚’å§‹ã‚ã‚‰ã‚Œã‚‹ã‚ˆã†ã€ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’å‰æã«é€²ã‚ã¾ã™ã€‚

```text
raidchain-1-webui-1/
â”œâ”€â”€ controller/            # (æ—¢å­˜) å®Ÿé¨“ãƒ­ã‚¸ãƒƒã‚¯ã®ä¸­æ ¸
â”œâ”€â”€ WebUI/
â”‚   â”œâ”€â”€ docker-compose.yml # (æ—¢å­˜) ãƒ•ãƒ­ãƒ³ãƒˆ/ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰èµ·å‹•ç”¨
â”‚   â”œâ”€â”€ backend/           # [æ–°è¦] Hono (Node.js) API Server
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ prisma/        # DB Schema
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ frontend/          # [æ–°è¦] Vite + React SPA
â”‚       â”œâ”€â”€ src/
â”‚       â””â”€â”€ package.json
â””â”€â”€ ...
```

-----

## ğŸ“… ãƒ•ã‚§ãƒ¼ã‚º 1: åŸºç›¤æ§‹ç¯‰ã¨ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç† (Infra Layer)

**ç›®çš„:** ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’æ¥ç¶šã—ã€Docker/K8s ã‚’ GUI ã‹ã‚‰æ“ä½œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

### 1.1 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰åˆæœŸåŒ– (Hono + Node.js)

Devcontainer å†…ã§ `WebUI/backend` ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚

  * **æŠ€è¡“:** Hono, Zod (ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³), Prisma (SQLite), child\_process (ã‚·ã‚§ãƒ«å®Ÿè¡Œç”¨)
  * **ã‚¿ã‚¹ã‚¯:**
    1.  Hono ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã€‚
    2.  `controller` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®ãƒ‘ã‚¹è§£æ±ºè¨­å®š (TypeScript Project References ã¾ãŸã¯ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯)ã€‚
    3.  Docker Socket çµŒç”±ã§ `docker build` ã‚’å©ããƒ©ãƒƒãƒ‘ãƒ¼é–¢æ•°ã®å®Ÿè£…ã€‚
    4.  `kubectl`, `helm` ã‚³ãƒãƒ³ãƒ‰ã‚’å©ããƒ©ãƒƒãƒ‘ãƒ¼é–¢æ•°ã®å®Ÿè£…ã€‚

### 1.2 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰åˆæœŸåŒ– (Vite + React)

Devcontainer å†…ã§ `WebUI/frontend` ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚

  * **æŠ€è¡“:** Vite, React, TypeScript, Tailwind CSS, Shadcn/UI, Xterm.js
  * **ã‚¿ã‚¹ã‚¯:**
    1.  Vite ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã€‚
    2.  UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (Shadcn/UI) ã®å°å…¥ã€‚
    3.  **Xterm.js** ã®å°å…¥ (ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°è¡¨ç¤ºç”¨)ã€‚

### 1.3 æ©Ÿèƒ½å®Ÿè£…: ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†

  * **API:**
      * `POST /api/v1/infra/images/build`: Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œã€‚
      * `POST /api/v1/infra/deployment`: Helm Install å®Ÿè¡Œã€‚
      * `WS /ws/infra/log`: ãƒ“ãƒ«ãƒ‰/ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ­ã‚°ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã€‚
  * **UI:**
      * ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ç”»é¢ã¨ã‚¿ãƒ¼ãƒŸãƒŠãƒ«é¢¨ãƒ­ã‚°è¡¨ç¤ºã€‚
      * ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã«ã‚ˆã‚‹ãƒã‚§ãƒ¼ãƒ³æ•°æŒ‡å®šã¨ãƒ‡ãƒ—ãƒ­ã‚¤ãƒœã‚¿ãƒ³ã€‚

-----

## ğŸ§ª ãƒ•ã‚§ãƒ¼ã‚º 2: å®Ÿé¨“ãƒ­ã‚¸ãƒƒã‚¯ã®çµ±åˆ (Core Logic Integration)

**ç›®çš„:** æ—¢å­˜ã® `controller` ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ API çµŒç”±ã§å®Ÿè¡Œå¯èƒ½ã«ã™ã‚‹ã€‚

### 2.1 æ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯ã®ç§»æ¤ãƒ»å‚ç…§

`controller` ã¯å„ªã‚ŒãŸè¨­è¨ˆ (DIãƒ‘ã‚¿ãƒ¼ãƒ³) ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã®ã§ã¯ãªãã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰**ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆ**ã—ã¦åˆ©ç”¨ã—ã¾ã™ã€‚

  * **æ–¹é‡:** `backend/src` ã‹ã‚‰ `../../controller/src/` å†…ã®ã‚¯ãƒ©ã‚¹ (`CompositeUploadStrategy`, `ChainManager` ç­‰) ã‚’ç›´æ¥åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã« `tsconfig.json` ã‚’èª¿æ•´ã—ã¾ã™ã€‚
  * **ã‚¿ã‚¹ã‚¯:**
    1.  `ChainManager` ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ãƒ©ãƒƒãƒ—ã™ã‚‹ã€‚
    2.  `ExperimentRunner` ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ API ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã«é©åˆã•ã›ã‚‹ã€‚

### 2.2 æ©Ÿèƒ½å®Ÿè£…: å®Ÿé¨“å®Ÿè¡Œ

  * **API:**
      * `GET /api/v1/experiments/strategies`: åˆ©ç”¨å¯èƒ½ãªæˆ¦ç•¥ä¸€è¦§ã‚’è¿”ã™ã€‚
      * `POST /api/v1/experiments/upload/virtual`: ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã¨ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†å®Ÿè¡Œã€‚
  * **UI:**
      * æˆ¦ç•¥é¸æŠãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ (Allocator / Transmitter)ã€‚
      * å®Ÿè¡Œãƒœã‚¿ãƒ³ã¨ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã€‚

### 2.3 ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ– (Prisma + SQLite)

  * å®Ÿé¨“çµæœã‚„ã‚·ãƒŠãƒªã‚ªã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã® DB è¨­è¨ˆã¨å®Ÿè£…ã€‚
      * `ExperimentResult` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã€‚
      * `UserAccount` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ (ControlChainç”¨)ã€‚

-----

## ğŸ“Š ãƒ•ã‚§ãƒ¼ã‚º 3: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚° (Visualization)

**ç›®çš„:** ã‚·ã‚¹ãƒ†ãƒ ã®æŒ™å‹•ã‚’å¯è¦–åŒ–ã—ã€ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³èƒ½åŠ›ã‚’é«˜ã‚ã‚‹ã€‚

### 3.1 WebSocket ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®å¼·åŒ–

æ—¢å­˜ã® `monitor-chain.ts` ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«çµ„ã¿è¾¼ã¿ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¸ãƒ—ãƒƒã‚·ãƒ¥é…ä¿¡ã—ã¾ã™ã€‚

  * **ã‚¿ã‚¹ã‚¯:**
    1.  `WebSocketCommunicationStrategy` ã‚’æ´»ç”¨ã—ã€å…¨ãƒã‚§ãƒ¼ãƒ³ã®ãƒ–ãƒ­ãƒƒã‚¯ç”Ÿæˆã‚¤ãƒ™ãƒ³ãƒˆã‚’è³¼èª­ã€‚
    2.  Mempool ã®çŠ¶æ…‹ (`num_unconfirmed_txs`) ã‚’å®šæœŸãƒãƒ¼ãƒªãƒ³ã‚°ã—ã€WS ã§é…ä¿¡ã€‚

### 3.2 æ©Ÿèƒ½å®Ÿè£…: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

  * **UI:**
      * **React Flow:** ãƒãƒ¼ãƒ‰æ§‹æˆå›³ (Control, Meta, Data-N) ã®æç”»ã€‚
      * **Recharts:** Mempool æ»ç•™é‡ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ£’ã‚°ãƒ©ãƒ•ã€‚
      * **Account Panel:** å„ãƒã‚§ãƒ¼ãƒ³ã® Relayer/Validator æ®‹é«˜è¡¨ç¤ºã¨ã‚¢ãƒ©ãƒ¼ãƒˆ (èµ¤æ–‡å­—è¡¨ç¤º)ã€‚

-----

## ğŸ’° ãƒ•ã‚§ãƒ¼ã‚º 4: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨çµŒæ¸ˆ (Economy & Polish)

**ç›®çš„:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Šã¨ã‚·ã‚¹ãƒ†ãƒ è‡ªå¾‹æ€§ã®è¨¼æ˜ã€‚

### 4.1 ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã¨Faucet

  * **æ©Ÿèƒ½:** ControlChain ä¸Šã§ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã¨ãƒˆãƒ¼ã‚¯ãƒ³ä»˜ä¸ã€‚
  * **UI:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã€ŒFaucetã€ãƒœã‚¿ãƒ³ã€‚

### 4.2 Relayer Watchdog (è‡ªå‹•è£œçµ¦)

  * **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰:** å®šæœŸå®Ÿè¡Œã‚¿ã‚¹ã‚¯ (Cron çš„ãªã‚‚ã®) ã‚’å®Ÿè£…ã€‚
      * Relayer ã®æ®‹é«˜ã‚’ç›£è¦–ã€‚
      * é–¾å€¤ã‚’ä¸‹å›ã£ãŸã‚‰ Millionaire ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰é€é‡‘ã‚’å®Ÿè¡Œã€‚
  * **UI:** è£œçµ¦ç™ºç”Ÿæ™‚ã®ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ (Sonner ç­‰ã‚’ä½¿ç”¨)ã€‚

-----

## ğŸ› ï¸ é–‹ç™ºã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

ã¾ãšã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ **Devcontainer ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«** ã§å®Ÿè¡Œã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é››å½¢ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

### 1\. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Hono) ã®ä½œæˆ

```bash
cd WebUI
mkdir backend
cd backend
# Honoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ– (Node.js)
npm create hono@latest .
# -> template: nodejs
# -> install dependencies: yes

# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è¿½åŠ 
yarn add zod @prisma/client prisma @types/node
yarn add -D ts-node typescript
```

### 2\. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Vite) ã®ä½œæˆ

```bash
cd ../
# frontendãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ (react-ts)
npm create vite@latest frontend -- --template react-ts

cd frontend
# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è¿½åŠ 
yarn add lucide-react clsx tailwind-merge react-router-dom
yarn add -D tailwindcss postcss autoprefixer
npx tailwindcss init -p

# UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª (Shadcn/UIã¯å¾Œã»ã© init)
```

### 3\. ä¾å­˜é–¢ä¿‚ã®ãƒªãƒ³ã‚¯ (é‡è¦)

`controller` ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰å‚ç…§ã™ã‚‹ãŸã‚ã«ã€`WebUI/backend/tsconfig.json` ã«ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’è¨­å®šã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

```json
// WebUI/backend/tsconfig.json (ä¾‹)
{
  "compilerOptions": {
    "baseUrl": "./",
    "paths": {
      "@controller/*": ["../../controller/src/*"]
    }
  }
}
```