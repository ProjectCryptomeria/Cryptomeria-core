## ğŸ“Š Raidchain å®Ÿé¨“ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  è©³ç´°ä»•æ§˜æ›¸ (æœ€çµ‚ç‰ˆ)

### 1. æ¦‚è¦

æœ¬ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯ã€Raidchainã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»æ¤œè¨¼å‡¦ç†ã®æ€§èƒ½ã‚„å®‰å®šæ€§ã‚’ã€æ§˜ã€…ãªæ¡ä»¶ä¸‹ã§å®šé‡çš„ã«è©•ä¾¡ã™ã‚‹ãŸã‚ã®Node.js/TypeScriptã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚ä¸»è¦ãªå‡¦ç†ã‚’**æˆ¦ç•¥ (Strategy)** ã¨ã—ã¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã—ã€**ä¾å­˜æ€§æ³¨å…¥ (Dependency Injection)** ã«ã‚ˆã£ã¦å®Ÿé¨“æ¡ä»¶ã‚’å®¹æ˜“ã«åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹æ§‹é€ ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

---

### 2. ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (`controller/src/core/`)

#### 2.1. `ExperimentRunner` ã‚¯ãƒ©ã‚¹ (`ExperimentRunner.ts`)

* **ç›®çš„:** å®Ÿé¨“å…¨ä½“ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ï¼ˆæº–å‚™ã€å®Ÿè¡Œã€è¨ˆæ¸¬ã€å¾Œå‡¦ç†ï¼‰ã‚’ç®¡ç†ã™ã‚‹ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã€‚
* **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:**
    * `constructor(config: ExperimentConfig, strategies: ExperimentStrategies)`: å®Ÿé¨“è¨­å®šã¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚ŒãŸæˆ¦ç•¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¾¤ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚å†…éƒ¨ã§ `InfrastructureService`, `ChainManager`, `PerformanceTracker` ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚
    * `async run(): Promise<ExperimentResult>`: å®Ÿé¨“ã®ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
        1.  `ChainManager` ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚
        2.  `RunnerContext` ã‚’ä½œæˆã—ã€å„æˆ¦ç•¥ãŒå¿…è¦ã¨ã™ã‚‹ä¾å­˜é–¢ä¿‚ï¼ˆ`chainManager`, `tracker`, å„æˆ¦ç•¥ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãªã©ï¼‰ã‚’ã¾ã¨ã‚ã¾ã™ã€‚
        3.  è¨­å®šã«åŸºã¥ãã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ (`runIteration` ã‚’å‘¼ã³å‡ºã—ï¼‰ã€‚
        4.  `chainManager.disconnectAll()` ã§å¾Œå‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚
        5.  `calculateSummary` ã§çµæœã‚’é›†è¨ˆã—ã€`ExperimentResult` ã‚’è¿”ã—ã¾ã™ã€‚
    * `async runIteration(chainCount: number, iteration: number): Promise<IterationResult>`: 1å›ã®å®Ÿé¨“ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
        1.  `prepareData` ã§ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ã—ã¾ã™ã€‚
        2.  `tracker.markUploadStart()` ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚
        3.  `uploadStrategy.execute()` ã‚’å‘¼ã³å‡ºã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
        4.  `downloadStrategy.execute()` ã‚’å‘¼ã³å‡ºã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
        5.  `verifyStrategy.execute()` ã‚’å‘¼ã³å‡ºã—ã¦æ¤œè¨¼ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
        6.  `tracker` ã«çµæœã‚’è¨˜éŒ²ã•ã›ã€`IterationResult` ã‚’è¿”ã—ã¾ã™ã€‚
    * `async prepareData(): Promise<Buffer>`: è¨­å®š (`config.target`) ã«åŸºã¥ãã€ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ã‹ã€æŒ‡å®šã‚µã‚¤ã‚ºã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
    * `calculateSummary(results: IterationResult[]): ExperimentSummary`: è¤‡æ•°ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®çµæœã‚’é›†è¨ˆã—ã¾ã™ï¼ˆç°¡æ˜“å®Ÿè£…ï¼‰ã€‚

#### 2.2. `ChainManager` ã‚¯ãƒ©ã‚¹ (`ChainManager.ts`)

* **ç›®çš„:** è¤‡æ•°ã®ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ãƒãƒ¼ãƒ‰ã¸ã®æ¥ç¶šã€ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ç®¡ç†ã‚’ä¸€å…ƒçš„ã«è¡Œã„ã¾ã™ã€‚
* **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:**
    * `constructor()`: åˆæœŸåŒ–ã¯ `init` ã§è¡Œã„ã¾ã™ã€‚
    * `async init(infraService: InfrastructureService, commStrategy: ICommunicationStrategy)`:
        1.  `infraService` ã‹ã‚‰ãƒã‚§ãƒ¼ãƒ³æƒ…å ±ã€RPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€ãƒ‹ãƒ¼ãƒ¢ãƒ‹ãƒƒã‚¯ã‚’å–å¾—ã—ã¾ã™ã€‚
        2.  å„ãƒã‚§ãƒ¼ãƒ³ã«ã¤ã„ã¦ `DirectSecp256k1HdWallet` ã‚’ä½œæˆã—ã¾ã™ã€‚
        3.  `commStrategy.connect()` ã‚’å‘¼ã³å‡ºã—ã€`commStrategy.getRpcClient()` ã§ RPC ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚
        4.  å–å¾—ã—ãŸ RPC ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚’ä½¿ã£ã¦ `SigningStargateClient` ãŠã‚ˆã³ `StargateClient` ã‚’ä½œæˆãƒ»æ¥ç¶šã—ã¾ã™ã€‚
        5.  `fetchAccount` ã§åˆæœŸã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç•ªå·ã¨ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã‚’å–å¾—ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚
    * `async fetchAccount(client: StargateClient, address: string, chainName: string): Promise<Account>`: æŒ‡å®šã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’ãƒã‚§ãƒ¼ãƒ³ã‹ã‚‰å–å¾—ã—ã¾ã™ï¼ˆãƒªãƒˆãƒ©ã‚¤ä»˜ãï¼‰ã€‚
    * `getChainAccount(chainName: string): ChainAccount`: æŒ‡å®šãƒã‚§ãƒ¼ãƒ³ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ï¼ˆã‚¦ã‚©ãƒ¬ãƒƒãƒˆã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç­‰ï¼‰ã‚’è¿”ã—ã¾ã™ã€‚
    * `getSigningClient(chainName: string): SigningStargateClient`: æŒ‡å®šãƒã‚§ãƒ¼ãƒ³ã®ç½²åã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’è¿”ã—ã¾ã™ã€‚
    * `getQueryClient(chainName: string): StargateClient`: æŒ‡å®šãƒã‚§ãƒ¼ãƒ³ã®ã‚¯ã‚¨ãƒªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’è¿”ã—ã¾ã™ã€‚
    * `getAddress(chainName: string): string`: æŒ‡å®šãƒã‚§ãƒ¼ãƒ³ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿”ã—ã¾ã™ã€‚
    * `getWallet(chainName: string): DirectSecp256k1HdWallet`: æŒ‡å®šãƒã‚§ãƒ¼ãƒ³ã®ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚’è¿”ã—ã¾ã™ã€‚
    * `getChainInfos(type?: ChainType): ChainInfo[]`: åˆ©ç”¨å¯èƒ½ãªãƒã‚§ãƒ¼ãƒ³æƒ…å ±ã®ãƒªã‚¹ãƒˆã‚’è¿”ã—ã¾ã™ï¼ˆã‚¿ã‚¤ãƒ—ã§ãƒ•ã‚£ãƒ«ã‚¿å¯èƒ½ï¼‰ã€‚
    * `getMetachainInfo(): ChainInfo`: metachain ã®æƒ…å ±ã‚’è¿”ã—ã¾ã™ã€‚
    * `getDatachainInfos(): ChainInfo[]`: datachain ã®æƒ…å ±ã®ãƒªã‚¹ãƒˆã‚’è¿”ã—ã¾ã™ã€‚
    * `getCurrentSequence(chainName: string): number`: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ã„ã‚‹ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã‚’è¿”ã—ã¾ã™ã€‚
    * `getAccountNumber(chainName: string): number`: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ã„ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç•ªå·ã‚’è¿”ã—ã¾ã™ã€‚
    * `incrementSequence(chainName: string, count?: number)`: æŒ‡å®šãƒã‚§ãƒ¼ãƒ³ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã—ã¾ã™ã€‚
    * `async resyncSequence(chainName: string): Promise<number>`: ãƒã‚§ãƒ¼ãƒ³ã‹ã‚‰æœ€æ–°ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’å–å¾—ã—ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã‚’åŒæœŸã—ã¾ã™ã€‚
    * `async disconnectAll()`: ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶šã‚’åˆ‡æ–­ã—ã€`commStrategy.disconnect()` ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

#### 2.3. `PerformanceTracker` ã‚¯ãƒ©ã‚¹ (`PerformanceTracker.ts`)

* **ç›®çš„:** 1å›ã®å®Ÿé¨“ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹å„ç¨®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆæ™‚é–“ã€Txæ•°ã€ã‚¬ã‚¹ä½¿ç”¨é‡ãªã©ï¼‰ã‚’è¨˜éŒ²ãƒ»é›†è¨ˆã—ã¾ã™ã€‚
* **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:**
    * `reset()`: å†…éƒ¨çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚
    * `markUploadStart()`, `markUploadEnd()`, `markDownloadStart()`, `markDownloadEnd()`: å„å‡¦ç†ãƒ•ã‚§ãƒ¼ã‚ºã®é–‹å§‹ãƒ»çµ‚äº†æ™‚åˆ»ï¼ˆ`bigint` ã®ãƒŸãƒªç§’ï¼‰ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚
    * `recordTransaction(info: TransactionInfo)` / `recordTransactions(infos: TransactionInfo[])`: å®Œäº†ã—ãŸãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®çµæœ (`ConfirmationResult` ã‚’å«ã‚€) ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚æˆåŠŸã—ãŸTxã§ä½¿ç”¨ã•ã‚ŒãŸãƒã‚§ãƒ¼ãƒ³åã‚’ `usedChains` (Set) ã«è¿½åŠ ã—ã¾ã™ã€‚
    * `setManifestUrl(url: string)`: ç™»éŒ²ã•ã‚ŒãŸãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆURLã‚’è¨˜éŒ²ã—ã¾ã™ã€‚
    * `setOriginalDataHash(hash: string)`, `setDownloadedDataHash(hash: string)`: ãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚·ãƒ¥å€¤ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚
    * `setChunkSizeUsed(bytes: number)`: ä½¿ç”¨ã•ã‚ŒãŸãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºã‚’è¨˜éŒ²ã—ã¾ã™ã€‚
    * `setVerificationResult(result: VerificationResult)`: æ¤œè¨¼çµæœã‚’è¨˜éŒ²ã—ã¾ã™ã€‚
    * `getUploadResult(): UploadResult`: è¨˜éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰çµæœã‚’é›†è¨ˆã—ã¦è¿”ã—ã¾ã™ï¼ˆæ‰€è¦æ™‚é–“ã€Txæ•°ã€ã‚¬ã‚¹åˆè¨ˆã€å¹³å‡ã‚¬ã‚¹ãªã©ï¼‰ã€‚
    * `getDownloadResult(downloadedData: Buffer): DownloadResult`: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰çµæœã‚’è¿”ã—ã¾ã™ã€‚
    * `getVerificationResult(): VerificationResult`: æ¤œè¨¼çµæœã‚’è¿”ã—ã¾ã™ã€‚

---

### 3. ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ (`controller/src/infrastructure/`)

#### 3.1. `InfrastructureService` ã‚¯ãƒ©ã‚¹ (`InfrastructureService.ts`)

* **ç›®çš„:** Kubernetes API ã¨é€£æºã—ã€Raidchain ã®ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒã«é–¢ã™ã‚‹æƒ…å ±ï¼ˆãƒã‚§ãƒ¼ãƒ³æ§‹æˆã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ‹ãƒ¼ãƒ¢ãƒ‹ãƒƒã‚¯ï¼‰ã‚’å–å¾—ã—ã¾ã™ã€‚
* **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:**
    * `constructor()`: Kubernetes ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (`@kubernetes/client-node`) ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚
    * `async getChainInfo(): Promise<ChainInfo[]>`: æŒ‡å®šã•ã‚ŒãŸãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã¨ãƒ©ãƒ™ãƒ«ã‚»ãƒ¬ã‚¯ã‚¿ (`app.kubernetes.io/component in (datachain, metachain)`) ã‚’æŒã¤ Pod ã‚’æ¤œç´¢ã—ã€ãƒã‚§ãƒ¼ãƒ³å (`app.kubernetes.io/instance` ãƒ©ãƒ™ãƒ«) ã¨ã‚¿ã‚¤ãƒ— (`app.kubernetes.io/component` ãƒ©ãƒ™ãƒ«) ã®ãƒªã‚¹ãƒˆã‚’è¿”ã—ã¾ã™ã€‚çµæœã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚APIå‘¼ã³å‡ºã—ã«ã¯ãƒªãƒˆãƒ©ã‚¤å‡¦ç†ãŒå«ã¾ã‚Œã¾ã™ã€‚
    * `async getCreatorMnemonic(chainName: string): Promise<string>`: æŒ‡å®šã•ã‚ŒãŸãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã® Secret (`raidchain-mnemonics`) ã‹ã‚‰ã€æŒ‡å®šã•ã‚ŒãŸã‚­ãƒ¼ (`<chainName>.mnemonic`) ã«å¯¾å¿œã™ã‚‹ Base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‹ãƒ¼ãƒ¢ãƒ‹ãƒƒã‚¯ã‚’å–å¾—ã—ã€ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦è¿”ã—ã¾ã™ã€‚çµæœã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚
    * `async getRpcEndpoints(): Promise<ChainEndpoints>`: å„ãƒã‚§ãƒ¼ãƒ³ã«å¯¾å¿œã™ã‚‹ Kubernetes Service (`raidchain-<chainName>-headless`) ã‚’æ¤œç´¢ã—ã€`rpc` ãƒãƒ¼ãƒˆæƒ…å ±ã‹ã‚‰ RPC ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ URL ã‚’ç”Ÿæˆã—ã¦è¿”ã—ã¾ã™ (`NODE_ENV` ã«å¿œã˜ã¦ NodePort ã¾ãŸã¯å†…éƒ¨ FQDN ã‚’ä½¿ç”¨)ã€‚Service å–å¾—ã«ã¯ãƒªãƒˆãƒ©ã‚¤å‡¦ç†ãŒå«ã¾ã‚Œã¾ã™ã€‚
    * `async getApiEndpoints(): Promise<ChainEndpoints>`: `getRpcEndpoints` ã¨åŒæ§˜ã«ã€`api` ãƒãƒ¼ãƒˆæƒ…å ±ã‹ã‚‰ REST API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ URL ã‚’ç”Ÿæˆã—ã¦è¿”ã—ã¾ã™ã€‚

---

### 4. æˆ¦ç•¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (`controller/src/strategies/`)

#### 4.1. ã‚¬ã‚¹è¨ˆç®—æˆ¦ç•¥ (`gas/`)

* **`IGasEstimationStrategy` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ (`IGasEstimationStrategy.ts`)**
    * **ç›®çš„:** ã‚¬ã‚¹ãƒªãƒŸãƒƒãƒˆã®è¦‹ç©ã‚‚ã‚Šæ–¹æ³•ã‚’æŠ½è±¡åŒ–ã—ã¾ã™ã€‚
    * **ãƒ¡ã‚½ãƒƒãƒ‰:**
        * `estimateGasLimit(context: RunnerContext, targetChainName: string, sampleMessage: EncodeObject): Promise<string>`: ã‚µãƒ³ãƒ—ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ã‚¬ã‚¹ãƒªãƒŸãƒƒãƒˆã‚’è¦‹ç©ã‚‚ã‚Šã€æ–‡å­—åˆ—ã¨ã—ã¦è¿”ã—ã¾ã™ã€‚
* **`SimulationGasEstimationStrategy` ã‚¯ãƒ©ã‚¹ (`SimulationGasEstimationStrategy.ts`)**
    * **ç›®çš„:** `IGasEstimationStrategy` ã®å®Ÿè£…ã‚¯ãƒ©ã‚¹ã€‚`SigningStargateClient.simulate()` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
    * **æ©Ÿèƒ½:**
        * `estimateGasLimit`:
            1.  `context.chainManager` ã‹ã‚‰å¯¾è±¡ãƒã‚§ãƒ¼ãƒ³ã® `signingClient` ã‚’å–å¾—ã—ã¾ã™ã€‚
            2.  `signingClient.simulate()` ã‚’å‘¼ã³å‡ºã—ã¦ `gasUsed` ã‚’å–å¾—ã—ã¾ã™ã€‚
            3.  `gasUsed` ã«ãƒãƒ¼ã‚¸ãƒ³ (`GAS_SIMULATION_MARGIN = 1.5`) ã‚’ä¹—ã˜ã¦ã‚¬ã‚¹ãƒªãƒŸãƒƒãƒˆã‚’è¨ˆç®—ã—ã€æ–‡å­—åˆ—ã§è¿”ã—ã¾ã™ã€‚
            4.  ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—æ™‚ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ (`FALLBACK_GAS_LIMIT`) ã‚’è¿”ã—ã¾ã™ã€‚
    * **é‡è¦ãªä»•æ§˜ (ã‚¬ã‚¹ä»£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ):** ã“ã®ã‚¯ãƒ©ã‚¹ãŒã€**æœ€åˆã®1ãƒãƒ£ãƒ³ã‚¯ (ã‚µãƒ³ãƒ—ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸) ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã€ãã®çµæœã« 1.5å€ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’åŠ ãˆã¦ã‚¬ã‚¹ãƒªãƒŸãƒƒãƒˆã‚’æ±ºå®šã™ã‚‹**ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‹…å½“ã—ã¾ã™ã€‚

#### 4.2. é€šä¿¡æˆ¦ç•¥ (`communication/`)

* **`ICommunicationStrategy` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ (`ICommunicationStrategy.ts`)**
    * **ç›®çš„:** ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ãƒãƒ¼ãƒ‰ã¨ã®ä½ãƒ¬ãƒ™ãƒ«é€šä¿¡ (HTTP/WebSocket) ã‚’æŠ½è±¡åŒ–ã—ã¾ã™ã€‚
    * **ãƒ¡ã‚½ãƒƒãƒ‰:** `connect(endpoint)`, `disconnect()`, `isConnected()`, `sendRpcRequest(request)`, `sendRestRequest(path, params?)`, `getRpcClient(endpoint)`, `subscribe?(query)`, `unsubscribe?(query)`ã€‚
* **`HttpCommunicationStrategy` ã‚¯ãƒ©ã‚¹ (`HttpCommunicationStrategy.ts`)**
    * **ç›®çš„:** `ICommunicationStrategy` ã® HTTP å®Ÿè£…ã€‚`fetch` API ã¨ `@cosmjs/tendermint-rpc` ã® `HttpBatchClient` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
    * **æ©Ÿèƒ½:**
        * `connect`: `HttpBatchClient` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æº–å‚™ã—ã€REST API ç”¨ã®ãƒ™ãƒ¼ã‚¹ URL ã‚’ç™»éŒ²ã—ã¾ã™ã€‚
        * `disconnect`: å†…éƒ¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã€‚
        * `sendRpcRequest`: ç›´æ¥ã¯ã‚µãƒãƒ¼ãƒˆã›ãšã€`getRpcClient` çµŒç”±ã§ã®ä½¿ç”¨ã‚’æƒ³å®šã—ã¾ã™ã€‚
        * `sendRestRequest`: `fetch` ã‚’ä½¿ã£ã¦ REST API ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚
        * `getRpcClient`: æº–å‚™æ¸ˆã¿ã® `HttpBatchClient` ã‚’è¿”ã—ã¾ã™ã€‚
        * `subscribe`/`unsubscribe`: ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¾ã™ã€‚
* **`WebSocketCommunicationStrategy` ã‚¯ãƒ©ã‚¹ (`WebSocketCommunicationStrategy.ts`)**
    * **ç›®çš„:** `ICommunicationStrategy` ã® WebSocket å®Ÿè£…ã€‚`@cosmjs/tendermint-rpc` ã® `WebsocketClient` ã¨ `Tendermint37Client` (ã¾ãŸã¯äº’æ›ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ) ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
    * **æ©Ÿèƒ½:**
        * `connect`: `attemptWsConnect` (ãƒªãƒˆãƒ©ã‚¤ä»˜ã) ã‚’å‘¼ã³å‡ºã—ã¦ `WebsocketClient` ã‚’æ¥ç¶šã—ã€`Tendermint37Client` ã‚’ä½œæˆãƒ»ä¿æŒã—ã¾ã™ã€‚
        * `disconnect`: ã™ã¹ã¦ã®è³¼èª­ã‚’è§£é™¤ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆ‡æ–­ã—ã¾ã™ã€‚
        * `sendRpcRequest`: ç›´æ¥ã¯ã‚µãƒãƒ¼ãƒˆã›ãšã€`getRpcClient` çµŒç”±ã§ã®ä½¿ç”¨ã‚’æƒ³å®šã—ã¾ã™ã€‚
        * `sendRestRequest`: `fetch` ã‚’ä½¿ã£ãŸãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’æä¾›ã—ã¾ã™ (éæ¨å¥¨)ã€‚
        * `getRpcClient`: æ¥ç¶šæ¸ˆã¿ã® `Tendermint37Client` ã‚’è¿”ã—ã¾ã™ã€‚
        * `subscribe`: `Tendermint37Client.subscribeTx()` ã‚’å‘¼ã³å‡ºã—ã€ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ  (`xstream`) ã‚’è¿”ã—ã¾ã™ã€‚è³¼èª­ç®¡ç†ã¯è¡Œã„ã¾ã›ã‚“ (å‘¼ã³å‡ºã—å…ƒãŒç®¡ç†)ã€‚
        * `unsubscribe`: è³¼èª­ç®¡ç†ã¯è¡Œã‚ãªã„ãŸã‚ã€ä½•ã‚‚ã—ã¾ã›ã‚“ (å‘¼ã³å‡ºã—å…ƒãŒ `Subscription.unsubscribe()` ã‚’ä½¿ç”¨)ã€‚
        * `attemptWsConnect`: (private)
            1.  `WebsocketClient` ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®šã—ã¾ã™ã€‚
            2.  `wsClient.connected` ãƒ—ãƒ­ãƒŸã‚¹ã‚’å¾…ã¡ã¾ã™ã€‚
            3.  **é‡è¦ãªä»•æ§˜ (WebSocketæ¥ç¶šæ™‚):** æ¥ç¶šå¾Œã€`wsClient.execute()` ã‚’ä½¿ã£ã¦ `"status"` RPC ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯) ã‚’é€ä¿¡ã—ã€å¿œç­”ãŒã‚ã‚‹ã¾ã§å¾…ã¡ã¾ã™ã€‚ã“ã‚Œã‚’è¡Œã‚ãªã„ã¨å¾Œç¶šå‡¦ç†ãŒã‚¹ã‚¿ãƒƒã‚¯ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
            4.  ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æˆåŠŸå¾Œã€`WebsocketClient` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã—ã¾ã™ã€‚ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¾ãŸã¯ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã¯ `reject` ã—ã¾ã™ã€‚

#### 4.3. å®Œäº†ç¢ºèªæˆ¦ç•¥ (`confirmation/`)

* **`IConfirmationStrategy` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ (`IConfirmationStrategy.ts`)**
    * **ç›®çš„:** é€ä¿¡æ¸ˆã¿ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®å®Œäº†ç¢ºèªæ–¹æ³•ã‚’æŠ½è±¡åŒ–ã—ã¾ã™ã€‚
    * **ãƒ¡ã‚½ãƒƒãƒ‰:** `confirmTransactions(context, chainName, txHashes, options): Promise<Map<string, ConfirmationResult>>`ã€‚
* **`PollingConfirmationStrategy` ã‚¯ãƒ©ã‚¹ (`PollingConfirmationStrategy.ts`)**
    * **ç›®çš„:** `IConfirmationStrategy` ã®ãƒãƒ¼ãƒªãƒ³ã‚°å®Ÿè£…ã€‚`communicationStrategy.getRpcClient()` ã§å–å¾—ã—ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã® `.tx()` ãƒ¡ã‚½ãƒƒãƒ‰ (Tendermint 0.37+/CometBFT) ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
    * **æ©Ÿèƒ½:**
        * `confirmTransactions`:
            1.  `context` ã‹ã‚‰ `communicationStrategy`, `infraService` ã‚’å–å¾—ã—ã€å¯¾è±¡ãƒã‚§ãƒ¼ãƒ³ã® RPC ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚`.tx()` ãƒ¡ã‚½ãƒƒãƒ‰ã®å­˜åœ¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
            2.  æœªç¢ºèªã®ãƒãƒƒã‚·ãƒ¥ (`pendingHashes`) ã‚’ Set ã§ç®¡ç†ã—ã¾ã™ã€‚
            3.  ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ (`options.timeoutMs`) ã¾ã§ãƒ«ãƒ¼ãƒ—ã—ã¾ã™ã€‚
            4.  ãƒ«ãƒ¼ãƒ—å†…ã§ã€`pendingHashes` ã®å„ãƒãƒƒã‚·ãƒ¥ã«ã¤ã„ã¦ `tmClient.tx({ hash: fromHex(hash) })` ã‚’ä¸¦åˆ—ã§å‘¼ã³å‡ºã—ã¾ã™ã€‚
            5.  `tx()` ãŒæˆåŠŸã—ãŸã‚‰ã€çµæœ (`TxResponse`) ã‚’ `ConfirmationResult` ã«å¤‰æ›ã—ã€`results` Map ã«æ ¼ç´ã€`pendingHashes` ã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã€‚("not found" ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–ã—ã¦ãƒãƒ¼ãƒªãƒ³ã‚°ã‚’ç¶™ç¶š)ã€‚
            6.  ãƒ«ãƒ¼ãƒ—çµ‚äº†å¾Œã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ãŸãƒãƒƒã‚·ãƒ¥ã‚’ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦ `results` ã«è¿½åŠ ã—ã¾ã™ã€‚
            7.  `results` Map ã‚’è¿”ã—ã¾ã™ã€‚
        * `extractFee`: (private) `TxResponse` ã‹ã‚‰ `tx.authInfo.fee` ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦æ‰‹æ•°æ–™ (`bigint`) ã‚’æŠ½å‡ºã—ã¾ã™ã€‚
* **`TxEventConfirmationStrategy` ã‚¯ãƒ©ã‚¹ (`TxEventConfirmationStrategy.ts`)**
    * **ç›®çš„:** `IConfirmationStrategy` ã® WebSocket ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­ã«ã‚ˆã‚‹å®Ÿè£…ã€‚`communicationStrategy.subscribe()` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
    * **æ©Ÿèƒ½:**
        * `confirmTransactions`:
            1.  `communicationStrategy` ãŒ `subscribe` ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚
            2.  `pendingHashes` Set ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚
            3.  `communicationStrategy.subscribe("tm.event = 'Tx'")` ã‚’å‘¼ã³å‡ºã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’å–å¾—ã—ã¾ã™ã€‚
            4.  `stream.subscribe()` ã§ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ© (`next`, `error`, `complete`) ã‚’è¨­å®šã—ã¾ã™ã€‚
            5.  `next` ãƒãƒ³ãƒ‰ãƒ©å†…ã§:
                * å—ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆ (`TxEvent`) ã‹ã‚‰ `event.hash` (Uint8Array) ã‚’ `toHex` ã§æ–‡å­—åˆ—ã«å¤‰æ›ã—ã¾ã™ã€‚
                * `pendingHashes` ã«å«ã¾ã‚Œã¦ã„ã‚Œã°ã€`event.result` ã¨ `event.height` ã‹ã‚‰ `ConfirmationResult` ã‚’ä½œæˆã— `results` Map ã«æ ¼ç´ã€`pendingHashes` ã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã€‚
                * `pendingHashes` ãŒç©ºã«ãªã£ãŸã‚‰ Promise ã‚’ `resolve` ã—ã¾ã™ã€‚
            6.  ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¿ã‚¤ãƒãƒ¼ã‚’è¨­å®šã—ã¾ã™ã€‚
            7.  Promise ãŒ `resolve` ã¾ãŸã¯ `reject` ã—ãŸã‚‰ã€`finally` ãƒ–ãƒ­ãƒƒã‚¯ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¯ãƒªã‚¢ã¨ `subscription.unsubscribe()` ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
            8.  `await confirmationPromise` ã§å¾…æ©Ÿã—ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ/ã‚¨ãƒ©ãƒ¼æ™‚ã«æœªç¢ºèªãƒãƒƒã‚·ãƒ¥ã‚’ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦ `results` ã«è¿½åŠ ã—ã¾ã™ã€‚
            9.  `results` Map ã‚’è¿”ã—ã¾ã™ã€‚

#### 4.4. ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆ¦ç•¥ (`upload/`)

* **`IUploadStrategy` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ (`IUploadStrategy.ts`)**
    * **ç›®çš„:** ãƒ‡ãƒ¼ã‚¿ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ‰‹é †ã‚’æŠ½è±¡åŒ–ã—ã¾ã™ã€‚
    * **ãƒ¡ã‚½ãƒƒãƒ‰:** `execute(context: RunnerContext, data: Buffer, targetUrl: string): Promise<UploadResult>`ã€‚
* **`SequentialUploadStrategy` ã‚¯ãƒ©ã‚¹ (`SequentialUploadStrategy.ts`)**
    * **ç›®çš„:** `IUploadStrategy` ã®å®Ÿè£…ã€‚ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒ£ãƒ³ã‚¯åŒ–ã—ã€**å˜ä¸€**ã®æŒ‡å®šã•ã‚ŒãŸ `datachain` ã«**é€æ¬¡çš„**ã«é€ä¿¡ã—ã¾ã™ã€‚
    * **æ©Ÿèƒ½:**
        * `execute`:
            1.  è¨­å®šã‹ã‚‰å¯¾è±¡ `datachain` å (`options.targetChain`) ã‚’å–å¾—ã—ã¾ã™ã€‚
            2.  ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒ£ãƒ³ã‚¯åŒ–ã—ã¾ã™ã€‚
            3.  **é‡è¦ãªä»•æ§˜ (ã‚¬ã‚¹ä»£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ):** `context.gasEstimationStrategy.estimateGasLimit()` ã‚’å‘¼ã³å‡ºã—ã¦ã‚¬ã‚¹ãƒªãƒŸãƒƒãƒˆã‚’è¦‹ç©ã‚‚ã‚Šã¾ã™ã€‚
            4.  ãƒãƒ£ãƒ³ã‚¯ãƒªã‚¹ãƒˆã‚’ãƒãƒƒãƒã«åˆ†å‰²ã—ã¾ã™ã€‚
            5.  å„ãƒãƒƒãƒã«ã¤ã„ã¦:
                * `sendChunkBatch` ã‚’å‘¼ã³å‡ºã—ã¦ Tx ã‚’é€ä¿¡ã—ã€ãƒãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚
                * `context.confirmationStrategy.confirmTransactions()` ã‚’å‘¼ã³å‡ºã—ã¦å®Œäº†ç¢ºèªã—ã¾ã™ã€‚
                * çµæœã‚’ `tracker` ã«è¨˜éŒ²ã—ã€å¤±æ•—ãŒã‚ã‚Œã°ä¸­æ–­ã—ã¾ã™ã€‚
            6.  `metachain` ã«ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ (`MsgCreateStoredManifest`) ã‚’ `signAndBroadcast('auto')` ã§é€ä¿¡ã—ã¾ã™ã€‚
            7.  `tracker.getUploadResult()` ã‚’è¿”ã—ã¾ã™ã€‚
        * `sendChunkBatch`: (private)
            1.  `gasLimit` ã‚’å¼•æ•°ã§å—ã‘å–ã‚Šã¾ã™ã€‚
            2.  ãƒãƒƒãƒå†…ã®å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ (`MsgCreateStoredChunk`) ã«ã¤ã„ã¦ã€`chainManager` ã‹ã‚‰å–å¾—ã—ãŸç¾åœ¨ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã‚’ä½¿ã£ã¦ `client.sign()` ã‚’å‘¼ã³å‡ºã—ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç½²åã—ã¾ã™ã€‚`fee` ã¯ `calculateFee(gasLimit, gasPrice)` ã§è¨ˆç®—ã—ãŸ `StdFee` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¸¡ã—ã¾ã™ã€‚
            3.  ç½²åå¾Œã€ãƒ­ãƒ¼ã‚«ãƒ«ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã‚’ `chainManager.incrementSequence()` ã§æ›´æ–°ã—ã¾ã™ã€‚
            4.  ç½²åæ¸ˆã¿ Tx (`TxRaw` ã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸ `Uint8Array`) ã‚’ `client.broadcastTxSync()` ã§ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã—ã¾ã™ã€‚
            5.  å„ Tx ã®ãƒãƒƒã‚·ãƒ¥ï¼ˆé€ä¿¡å‰ã«è¨ˆç®—ï¼‰ã®ãƒªã‚¹ãƒˆã‚’è¿”ã—ã¾ã™ã€‚
* **`RoundRobinUploadStrategy` ã‚¯ãƒ©ã‚¹ (`RoundRobinUploadStrategy.ts`)**
    * **ç›®çš„:** `IUploadStrategy` ã®å®Ÿè£…ã€‚ãƒãƒ£ãƒ³ã‚¯ã‚’è¤‡æ•°ã® `datachain` ã«**ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³**ã§å‰²ã‚Šå½“ã¦ã€**ä¸¦åˆ—**ã«é€ä¿¡ã—ã¾ã™ã€‚
    * **æ©Ÿèƒ½:**
        * `execute`:
            1.  è¨­å®šã‹ã‚‰ä½¿ç”¨ã™ã‚‹ `datachain` æ•° (`config.chainCount`) ã‚’æ±ºå®šã—ã¾ã™ã€‚
            2.  ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒ£ãƒ³ã‚¯åŒ–ã—ã¾ã™ã€‚
            3.  **é‡è¦ãªä»•æ§˜ (ã‚¬ã‚¹ä»£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ):** `context.gasEstimationStrategy.estimateGasLimit()` ã‚’å‘¼ã³å‡ºã—ã¦ã‚¬ã‚¹ãƒªãƒŸãƒƒãƒˆã‚’è¦‹ç©ã‚‚ã‚Šã¾ã™ã€‚ï¼ˆâ€»æ³¨: ç¾åœ¨ã®å®Ÿè£…ã§ã¯ `execute` ã®å…ˆé ­ã§ã¯ãªãã€`runWorker` å†…ã§å„ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒå€‹åˆ¥ã«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã‹ã€`execute` ã§1å›ã ã‘ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦å…¨ãƒ¯ãƒ¼ã‚«ãƒ¼ã§å…±æœ‰ã™ã‚‹ã‹ã€å†æ¤œè¨ã®ä½™åœ°ã‚ã‚Šã€‚ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ `execute` ã§1å›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã€`runWorker` ã« `estimatedGasLimit` ã‚’æ¸¡ã™å½¢ã‚’æƒ³å®šã€‚ï¼‰
            4.  ãƒãƒ£ãƒ³ã‚¯ã‚’å¯¾è±¡ `datachain` ã«ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³ã§å‰²ã‚Šå½“ã¦ã€ãƒã‚§ãƒ¼ãƒ³ã”ã¨ã® `UploadJob` ã‚’ä½œæˆã—ã¾ã™ã€‚
            5.  å„ `UploadJob` ã«ã¤ã„ã¦ `runWorker` ã‚’ `Promise.all` ã§ä¸¦åˆ—å®Ÿè¡Œã—ã¾ã™ã€‚
            6.  å…¨ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒæˆåŠŸã—ãŸã‚‰ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ç™»éŒ²ã—ã¾ã™ã€‚
            7.  `tracker.getUploadResult()` ã‚’è¿”ã—ã¾ã™ã€‚
        * `runWorker`: (private) 1ãƒã‚§ãƒ¼ãƒ³æ‹…å½“ã®ãƒ¯ãƒ¼ã‚«ãƒ¼å‡¦ç†ã€‚æ‹…å½“ãƒãƒ£ãƒ³ã‚¯ã‚’ãƒãƒƒãƒã«åˆ†å‰²ã—ã€`sendChunkBatch` ã¨ `confirmTransactions` ã‚’é€æ¬¡å®Ÿè¡Œã—ã¾ã™ã€‚
        * `sendChunkBatch`: (private) `SequentialUploadStrategy` ã¨åŒã˜å®Ÿè£…ã€‚
* **`AutoDistributeUploadStrategy` ã‚¯ãƒ©ã‚¹ (`AutoDistributeUploadStrategy.ts`)**
    * **ç›®çš„:** `IUploadStrategy` ã®å®Ÿè£…ã€‚ãƒãƒ£ãƒ³ã‚¯ã‚’é€ä¿¡ã™ã‚‹ç›´å‰ã«å„ `datachain` ã® **Mempool** çŠ¶æ³ã‚’ç›£è¦–ã—ã€**æœ€ã‚‚ç©ºã„ã¦ã„ã‚‹ãƒã‚§ãƒ¼ãƒ³**ã«å‹•çš„ã«ãƒãƒƒãƒã‚’å‰²ã‚Šå½“ã¦ã¦é€ä¿¡ã—ã¾ã™ã€‚
    * **æ©Ÿèƒ½:**
        * `execute`:
            1.  è¨­å®šã‹ã‚‰ä½¿ç”¨ã™ã‚‹ `datachain` æ•°ã‚’æ±ºå®šã—ã¾ã™ã€‚
            2.  ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒ£ãƒ³ã‚¯åŒ–ã—ã¾ã™ã€‚
            3.  **é‡è¦ãªä»•æ§˜ (ã‚¬ã‚¹ä»£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ):** `context.gasEstimationStrategy.estimateGasLimit()` ã‚’å‘¼ã³å‡ºã—ã¦ã‚¬ã‚¹ãƒªãƒŸãƒƒãƒˆã‚’è¦‹ç©ã‚‚ã‚Šã¾ã™ã€‚
            4.  ãƒãƒ£ãƒ³ã‚¯ã‚’ãƒãƒƒãƒã«åˆ†å‰²ã—ã€`batchQueue` ã‚’ä½œæˆã—ã¾ã™ã€‚
            5.  `batchQueue` ãŒç©ºã«ãªã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—:
                * `findAvailableChain` ã§ Mempool ã«ç©ºããŒã‚ã‚‹ãƒã‚§ãƒ¼ãƒ³ã‚’æ¢ã—ã¾ã™ã€‚
                * ç©ºããƒã‚§ãƒ¼ãƒ³ãŒè¦‹ã¤ã‹ã£ãŸã‚‰ `batchQueue` ã‹ã‚‰ãƒãƒƒãƒã‚’å–ã‚Šå‡ºã—ã€`runBatchWorker` ã‚’éåŒæœŸã§å®Ÿè¡Œã—ã¾ã™ã€‚
            6.  å®Ÿè¡Œä¸­ã® `runBatchWorker` ãŒã™ã¹ã¦å®Œäº†ã™ã‚‹ã®ã‚’å¾…ã¡ã¾ã™ã€‚
            7.  å…¨ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒæˆåŠŸã—ãŸã‚‰ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ç™»éŒ²ã—ã¾ã™ã€‚
            8.  `tracker.getUploadResult()` ã‚’è¿”ã—ã¾ã™ã€‚
        * `findAvailableChain`: (private) å¯¾è±¡ `datachain` ã® Mempool çŠ¶æ³ (`numUnconfirmedTxs`) ã‚’ä¸¦åˆ—ã§ãƒãƒ¼ãƒªãƒ³ã‚°ã—ã€`MEMPOOL_BYTES_LIMIT` ä»¥ä¸‹ã®ãƒã‚§ãƒ¼ãƒ³ãŒè¦‹ã¤ã‹ã‚‹ã‹ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã™ã‚‹ã¾ã§å¾…æ©Ÿã—ã¾ã™ã€‚
        * `getTmClient`: (private) `context` ã‹ã‚‰ç‰¹å®šã®ãƒã‚§ãƒ¼ãƒ³ã® `TendermintClient` ã‚’å–å¾—ã—ã¾ã™ (`numUnconfirmedTxs` ã‚’æŒã¤ã“ã¨ã‚’ç¢ºèª)ã€‚
        * `runBatchWorker`: (private) 1ãƒãƒƒãƒåˆ†ã®å‡¦ç†ã€‚`sendChunkBatch` ã¨ `confirmTransactions` ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
        * `sendChunkBatch`: (private) `SequentialUploadStrategy` ã¨åŒã˜å®Ÿè£…ã€‚

#### 4.5. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æˆ¦ç•¥ (`download/`)

* **`IDownloadStrategy` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ (`IDownloadStrategy.ts`)**
    * **ç›®çš„:** Raidchain ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ‰‹é †ã‚’æŠ½è±¡åŒ–ã—ã¾ã™ã€‚
    * **ãƒ¡ã‚½ãƒƒãƒ‰:** `execute(context: RunnerContext, targetUrl: string): Promise<DownloadResult>`ã€‚
* **`HttpDownloadStrategy` ã‚¯ãƒ©ã‚¹ (`HttpDownloadStrategy.ts`)**
    * **ç›®çš„:** `IDownloadStrategy` ã®å®Ÿè£…ã€‚HTTP/REST API ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
    * **æ©Ÿèƒ½:**
        * `execute`:
            1.  `context.infraService` ã‹ã‚‰ `metachain` ã¨ `datachain` ã® API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚
            2.  `context.communicationStrategy.sendRestRequest()` ã‚’ä½¿ç”¨ã—ã¦ `metachain` ã‹ã‚‰ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’å–å¾—ãƒ»ãƒ‘ãƒ¼ã‚¹ã—ã¾ã™ã€‚
            3.  ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆå†…ã®ãƒãƒ£ãƒ³ã‚¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚
            4.  `downloadChunksConcurrently` ã‚’å‘¼ã³å‡ºã—ã¦ã€ãƒãƒ£ãƒ³ã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ `datachain` ã‹ã‚‰ä¸¦åˆ—ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
            5.  ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒãƒ£ãƒ³ã‚¯ (Buffer) ã‚’ `Buffer.concat` ã§çµåˆã—ã€`DownloadResult` ã‚’è¿”ã—ã¾ã™ã€‚
        * `downloadChunksConcurrently`: (private) ãƒãƒ£ãƒ³ã‚¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ãƒã‚§ãƒ¼ãƒ³ã«å‰²ã‚Šå½“ã¦ (ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç•ªå· % ãƒã‚§ãƒ¼ãƒ³æ•°)ã€`communicationStrategy.sendRestRequest()` ã‚’ä½¿ã£ã¦ä¸¦åˆ—ï¼ˆæœ€å¤§ `MAX_CONCURRENT_DOWNLOADS`ï¼‰ã§ãƒãƒ£ãƒ³ã‚¯ã‚’å–å¾—ã—ã€Base64 ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦ Buffer ã®ãƒªã‚¹ãƒˆã‚’è¿”ã—ã¾ã™ã€‚

#### 4.6. æ¤œè¨¼æˆ¦ç•¥ (`verification/`)

* **`IVerificationStrategy` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ (`IVerificationStrategy.ts`)**
    * **ç›®çš„:** 2ã¤ã®ãƒ‡ãƒ¼ã‚¿ãŒåŒä¸€ã‹æ¤œè¨¼ã™ã‚‹æ–¹æ³•ã‚’æŠ½è±¡åŒ–ã—ã¾ã™ã€‚
    * **ãƒ¡ã‚½ãƒƒãƒ‰:** `execute(originalData: Buffer, downloadedData: Buffer, options?: VerificationOptions): Promise<VerificationResult>`ã€‚
* **`BufferVerificationStrategy` ã‚¯ãƒ©ã‚¹ (`BufferVerificationStrategy.ts`)**
    * **ç›®çš„:** `IVerificationStrategy` ã®å®Ÿè£…ã€‚`Buffer.compare()` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
    * **æ©Ÿèƒ½:**
        * `execute`:
            1.  `options.compareBytes` ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚Œã°ã€æŒ‡å®šãƒã‚¤ãƒˆæ•°ã ã‘ `originalData` ã¨ `downloadedData` ã®å…ˆé ­ã‚’ `Buffer.compare()` ã§æ¯”è¼ƒã—ã¾ã™ã€‚
            2.  æŒ‡å®šã•ã‚Œã¦ã„ãªã‘ã‚Œã°ã€ã¾ãšãƒ‡ãƒ¼ã‚¿é•·ã‚’æ¯”è¼ƒã—ã€ç•°ãªã‚Œã°å¤±æ•—ã¨ã—ã¾ã™ã€‚åŒã˜ã§ã‚ã‚Œã° `Buffer.compare()` ã§å…¨ä½“ã‚’æ¯”è¼ƒã—ã¾ã™ã€‚
            3.  æ¯”è¼ƒçµæœ (`Buffer.compare` ã®æˆ»ã‚Šå€¤ãŒ 0 ãªã‚‰ä¸€è‡´) ã‚’ `VerificationResult` ã¨ã—ã¦è¿”ã—ã¾ã™ã€‚

---

### 5. å‹å®šç¾© (`controller/src/types/`)

* **`context.ts`**: `RunnerContext` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã€‚å„æˆ¦ç•¥ãŒå¿…è¦ã¨ã™ã‚‹ä¾å­˜é–¢ä¿‚ï¼ˆ`chainManager`, `tracker`, å„æˆ¦ç•¥ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãªã©ï¼‰ã‚’ã¾ã¨ã‚ã¾ã™ã€‚
* **`cosmos.ts`**: `MsgCreateStoredChunk`, `MsgCreateStoredManifest`, `ChainInfo` ãªã©ã€Cosmos SDK ã‚„ Raidchain å›ºæœ‰ã®å‹ã‚’å®šç¾©ã—ã¾ã™ã€‚
* **`experiment.ts`**: `ExperimentConfig` (å®Ÿé¨“è¨­å®š), `ExperimentResult` (å…¨ä½“çµæœ), `IterationResult` (ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ), `UploadResult`, `DownloadResult`, `VerificationResult`, `ConfirmationResult` ãªã©ã€å®Ÿé¨“ã®å®Ÿè¡Œã¨çµæœã«é–¢é€£ã™ã‚‹å‹ã‚’å®šç¾©ã—ã¾ã™ã€‚
* **`index.ts`**: ä¸Šè¨˜ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¸»è¦ãªå‹ã‚’å†ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

---

### 6. ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (`controller/src/utils/`)

* **`logger.ts`**: `winston` ã‚’ä½¿ç”¨ã—ãŸãƒ­ã‚¬ãƒ¼ã‚’æä¾›ã—ã¾ã™ã€‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¨ãƒ•ã‚¡ã‚¤ãƒ« (`experiments/results/logs/`) ã¸ã®å‡ºåŠ›ã€ãƒ‡ãƒãƒƒã‚°ãƒ¬ãƒ™ãƒ«åˆ‡ã‚Šæ›¿ãˆã€ã‚¨ãƒ©ãƒ¼ã‚µãƒãƒªãƒ¼è¡¨ç¤º (`flushErrorLogs`) æ©Ÿèƒ½ã‚’æŒã¡ã¾ã™ã€‚`log` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ (`log.info`, `log.error` ãªã©) ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
* **`retry.ts`**: éåŒæœŸé–¢æ•°ã‚’æŒ‡å®šå›æ•°ãƒªãƒˆãƒ©ã‚¤ã™ã‚‹ `withRetry` é–¢æ•°ã¨ã€å˜ç´”ãª `sleep` é–¢æ•°ã‚’æä¾›ã—ã¾ã™ã€‚`withRetry` ã¯æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã¨ã‚¸ãƒƒã‚¿ãƒ¼ã«å¯¾å¿œã—ã¾ã™ã€‚

---

### 7. ãã®ä»– (`controller/src/`)

* **`registry.ts`**: `@cosmjs/proto-signing` ã® `Registry` ã‚’ä½œæˆã—ã€`MsgCreateStoredChunk` ã¨ `MsgCreateStoredManifest` ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰/ãƒ‡ã‚³ãƒ¼ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç™»éŒ²ã—ã¾ã™ã€‚`customRegistry` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
* **`run-experiment.ts`**: å®Ÿé¨“å®Ÿè¡Œã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã€‚
    1.  `parseArgs` ã§ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ï¼ˆ`--config`, `--debug`ï¼‰ã‚’è§£æã—ã¾ã™ã€‚
    2.  `--config` ã§æŒ‡å®šã•ã‚ŒãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ« (`.config.ts`) ã‚’å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ (`import()`) ã—ã¾ã™ã€‚
    3.  `instantiateStrategies` ã§è¨­å®šã«åŸºã¥ãå…·è±¡æˆ¦ç•¥ã‚¯ãƒ©ã‚¹ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã¾ã™ã€‚
    4.  `ExperimentRunner` ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã€`run()` ã‚’å‘¼ã³å‡ºã—ã¦å®Ÿé¨“ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
    5.  çµæœã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã—ã€`formatResultsAsCSV` ã§ CSV æ–‡å­—åˆ—ã«å¤‰æ›ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ« (`experiments/results/results_*.csv`) ã«ä¿å­˜ã—ã¾ã™ã€‚
    6.  `log.flushErrorLogs()` ã§ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
* **`scripts/interactive-runner.ts`**: (`just ctl-exp` ã‹ã‚‰å‘¼ã°ã‚Œã‚‹) `enquirer` ã‚’ä½¿ç”¨ã—ã¦ã€å¯¾è©±å½¢å¼ã§å®Ÿè¡Œã™ã‚‹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠã—ã€`run-experiment.ts` ã‚’å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚