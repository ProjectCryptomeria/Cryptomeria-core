---
DocType: GUIDE
SourceOfTruth: code
Status: draft
LastReviewed: 2026-01-25
Owners: TBD
---

# Runbook / Troubleshooting

## 1. 目的
障害時に「何を見るか」「どう戻すか」を短時間で辿れるようにする。

## 2. 復旧優先順位
1) データ保護（PVC/状態を壊さない）  
2) 接続復旧（relayer/IBC）  
3) 参照解決の復旧（endpoint registry）  
4) 再実行（upload/download の再試行）

## 3. まずやるチェック
- Pod 状態：`kubectl get pod -n cryptomeria`
- logs：`just chain::logs gwc` 等
- relayer ready：`kubectl get pod -n cryptomeria -l app.kubernetes.io/component=relayer`

## 4. 症状別プレイブック
### 4.1 `gwcd q gateway endpoints` が空
原因候補：
- IBC接続が未作成
- register-storage 未実行
対処：
- `just start-system` を再実行
- `ops/scripts/control/connect-chain.sh` で個別接続
- 最終手段：`gwcd tx gateway register-storage ...` で手動登録

### 4.2 Download が「manifest not found」
原因候補：
- MDSC に project/version が存在しない
- project 名が違う
対処：
- MDSC API で manifest を直接確認（1317）
- upload 側の finalize が成功しているか確認

### 4.3 Download が「fragment missing / timeout」
原因候補：
- FDSC に fragment がない（配送失敗/欠損）
- endpoint が誤っている（違うFDSCを指す）
- FDSC API 不達
対処：
- endpoints を確認し、FDSC URL が到達可能か確認
- relayer ログで packet/ack を確認
- FDSC Pod のログ確認

### 4.4 relayer が動かない / packet が流れない
原因候補：
- relayer 設定未初期化
- 鍵/パス設定不整合
対処：
- `ops/scripts/control/init-relayer.sh` → `start-relayer.sh` を再実行
- relayer PVC を消さずに再起動（状態維持）

### 4.5 fragment conflict が出る
原因候補：
- 同一 (session_id, path, index) に別データを送っている
対処：
- セッション/入力データの再確認
- 実験なら “conflict を起こす条件” を固定して再現性を取る

## 5. 事後チェック（簡易）
- endpoints が期待どおり登録されているか
- manifest が MDSC に存在するか
- fragment の一部が FDSC から取得できるか
