# RaidChain PoC 実装状況レポート (v1.0)

## 1. 実装済み機能の要約 (Accomplished)

本フェーズでは、**「データの分散保存パイプラインの確立」**に焦点を当て、GWCからFDSC/MDSCへのIBC通信を通じたデータフローを実装しました。

### 🛡️ GWC (Gateway Chain) - ルーター機能
* **アップロード受付 (`MsgUpload`)**: クライアントからのファイルアップロード要求を受け付けるトランザクションを実装。
* **データ分割 (Sharding)**: 受信したバイナリデータを固定サイズ（10KB）のチャンクに分割するロジックを実装。
* **並列分散送信 (Fragment Distribution)**: 分割したチャンクを `FragmentPacket` として構築し、IBC経由でデータストア（FDSC）へ送信する処理を実装。
* **メタデータ同期 (Manifest Sync)**: 全データの送信完了後、ファイル構成情報（IDリスト、サイズ、MIMEタイプ）を `ManifestPacket` としてメタデータストア（MDSC）へ送信する処理を実装。
* **ibc-go v10対応**: 最新のCosmos SDK/IBC仕様に合わせ、パケット送信時のCapability管理（`ScopedKeeper`の除外）やエラーハンドリングを修正。

### 💾 FDSC (FragmentData Storage Chain) - データ保存
* **Fragment受信ロジック**: IBC経由で `FragmentPacket` を受信し、KVStore上の `Fragment` マップに保存する処理を実装。
* **Proto定義の最適化**: Goのコード生成における名前衝突（`Size` メソッド）を回避するため、フィールド名を `file_size` に修正。

### 📖 MDSC (ManifestData Storage Chain) - 管理台帳
* **Manifest受信ロジック**: IBC経由で `ManifestPacket` を受信し、プロジェクト名をキーとして `Manifest` マップに保存する処理を実装。
* **データ構造の整備**: ファイル名、サイズ、各断片の保存場所（`fdsc_id`, `fragment_id`）を階層的に管理するデータ構造を定義。

---

## 2. 今後の課題と未実装機能 (To-Do & Considerations)

PoCとしては機能しますが、本番運用に向けて以下の機能強化が必要です。

### ⚠️ 信頼性と整合性
* **Ackとエラーハンドリング**:
    * 現状はパケットを「投げっぱなし」です。FDSCで保存に失敗した場合（容量不足など）のエラーAckをGWCで受け取り、ユーザーへの通知やリトライを行う補償トランザクション（Sagaパターン）の実装が必要です。
* **順序保証と整合性チェック**:
    * パケット到着順序が前後しても問題ない設計にしていますが、マニフェストが断片より先に届いた場合の参照整合性チェック（Dangling Referenceの防止）を強化する必要があります。

### ⚙️ 拡張性と構成管理
* **チャネルIDの動的解決**:
    * 現在、GWC内の送信先チャネルIDは `channel-0` (FDSC), `channel-1` (MDSC) に固定されています。これをオンチェーンパラメータ（`Params`）やガバナンスで動的に設定・変更できる機能が必要です。
* **マルチFDSC対応**:
    * 現状は単一のFDSC（`fdsc-0`）に全ての断片を送っています。複数のFDSCに対してラウンドロビン等で振り分けるロジックの実装が必要です。

### 🖥️ クライアントサイド (WebUI/Controller)
* **ダウンロードと結合**:
    * MDSCからマニフェストを取得し、そこに記載されたIDに基づいてFDSCから断片を並列ダウンロード・結合して元のファイルを復元するクライアント側のロジックが必要です（これはブロックチェーン外の実装です）。