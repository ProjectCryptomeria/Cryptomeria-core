# 📚 Cryptomeria Core: Data Transfer Strategy Catalog

本ドキュメントは、Cryptomeria Coreにおけるデータ転送（アップロード・ダウンロード）の全戦略案を網羅的にリストアップし、それぞれの特性を中立的に評価したものです。

---

## Ⅰ. アップロード戦略の全ケース評価

アップロード戦略は、**チェーン構成**（単一/複数）、**送出方式**（ワンバイワン/バースト）、**割当方式**（静的/動的）の組み合わせにより、以下の14ケースに分類されます。

### 1. 単一チェーン戦略 (Single Chain)
システム全体の基準となるベースラインです。スケーラビリティはありませんが、構造が単純です。

| ケースID | 構成要素 | 特徴と評価 |
| :--- | :--- | :--- |
| **S-1** | **Static / One-By-One** | **[安定性重視]**<br>最も基本的で堅実な構成。速度はブロック生成時間に依存し、最も遅い。比較対照用のベースライン。 |
| **S-2** | **Dynamic / One-By-One** | **[効率化の試行]**<br>共通キューを用いるが、送信先が1つであるため、静的割当（S-1）に対する優位性は限定的。 |
| **S-3** | **Static / Burst** | **[速度重視]**<br>バースト転送によりスループットは向上するが、静的割当のため、特定のデータ処理で詰まるとリカバリが効かない。 |
| **S-4** | **Dynamic / Burst** | **[単一チェーンの限界]**<br>単一チェーン構成における理論上の最大速度。ただし、チェーンの処理能力上限（TPS）がシステム全体のキャップとなる。 |

### 2. 複数チェーン・静的割当戦略 (Multi Chain / Mega Chunk)
データを事前に分割して各エージェント（Relayer）に固定で割り振る方式です。

| ケースID | 構成要素 | 特徴と評価 |
| :--- | :--- | :--- |
| **M-1** | **Static / One-By-One** | **[確実な分散]**<br>確実に負荷分散されるが、特定のエージェントやチェーンが遅延しても、他が手助けできない（全体完了時間は最も遅いエージェントに依存する）。 |
| **M-2** | **Static / Burst** | **[高速な分散]**<br>M-1の高速版。バーストにより個々の処理は速くなるが、静的割当による「遅延の道連れ」リスクは残る。 |

### 3. 複数チェーン・動的割当・安定転送 (Multi / Common Queue / One-By-One)
共通キューを採用し、空いたエージェントからタスクを処理する方式です。チェーン選択ロジックにより特性が分岐します。

| ケースID | チェーン選択 | 特徴と評価 |
| :--- | :--- | :--- |
| **M-3_B** | **Round Robin (RR)** | **[バランス型]**<br>機械的に順番に送信する。データは均等に分散され、読み込み時の負荷も平準化される。特定のチェーンが詰まってもスキップはできない。 |
| **M-3_C** | **Random** | **[簡易分散]**<br>実装は単純だが、短期的には特定のチェーンに負荷が偏る可能性がある。RRと大差はない。 |
| **M-3_D** | **Available (空き選択)** | **[書き込み効率化]**<br>Mempoolが空いているチェーンを優先する。書き込み待ち時間は最小化されるが、特定チェーンへのデータ偏在（読み込みホットスポット）のリスクがある。 |

### 4. 複数チェーン・動的割当・バースト転送 (Multi / Common Queue / Burst)
動的割当とバースト転送を組み合わせた、最も高スループットな構成です。制御パラメータ（Mempool監視等）の実装が必須となります。

| ケースID | チェーン選択 | 特徴と評価 |
| :--- | :--- | :--- |
| **M-4_B** | **Round Robin (RR)** | **[高速バランス型]**<br>バーストによる速度と、RRによるデータ均等分散を両立。書き込み・読み込み双方の性能が予測しやすく、運用安定性が高い。 |
| **M-4_C** | **Random** | **[高速ランダム]**<br>M-4_Bに近いが、ランダム性ゆえに「たまたま高負荷なチェーン」を引き当てるリスクがわずかにある。 |
| **M-4_D** | **Available (空き選択)** | **[最大速度特化]**<br>「今空いている場所」にバーストで投げ込むため、書き込み速度は全戦略中No.1となる。反面、データの偏在リスクが最大となり、将来的なダウンロード性能に影響を及ぼす可能性がある。 |

---

## Ⅱ. ダウンロードロジックの改善案一覧

現状の「1対1通信（HTTP）」が抱える課題（SPOF、負荷集中）に対する解決アプローチの選択肢です。

### 現状 (Current Implementation)
* **構成**: GWCが特定の1ノード（IP指定）と通信。
* **評価**: 開発環境ではシンプルだが、本番運用（マルチノード）には耐えられない。

### 案A: インフラストラクチャ・ロードバランシング (Infrastructure LB)
Kubernetes等のインフラ機能を用いて解決する「Web2的アプローチ」です。

* **概要**: 各チェーンの前段にロードバランサ（Service）を配置し、GWCはそのDNS名に対してリクエストを送る。
* **メリット**:
    * **実装コスト低**: アプリケーションコード（GWC）の修正が不要。
    * **信頼性**: クラウドプロバイダやK8sの成熟した技術を利用できる。
* **デメリット**:
    * **中央集権的**: ロードバランサ自体がシステムの一部となる（ただしK8s内では冗長化可能）。

### 案B: クライアントサイド・ロードバランシング (Client-Side LB)
GWC自体がインテリジェントに振る舞う「Web3的アプローチ」です。

* **概要**: GWCが全ノードのリスト（Peer List）を保持・更新し、リクエストのたびに送信先ノードを自律的に選択する。
* **メリット**:
    * **分散性**: 特定のロードバランサに依存せず、真のP2P的な耐障害性を獲得できる。
    * **柔軟性**: レイテンシの低いノードを優先するなど、独自のロジックを組み込める。
* **デメリット**:
    * **実装コスト高**: ノードの死活監視やリスト更新ロジックを自前で実装する必要がある。