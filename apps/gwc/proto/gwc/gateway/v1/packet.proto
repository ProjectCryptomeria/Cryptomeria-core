syntax = "proto3";
package gwc.gateway.v1;

option go_package = "gwc/x/gateway/types";

// GatewayPacketData defines the packet data for the gateway module
message GatewayPacketData {
  oneof packet {
    NoDataPacket   no_data_packet   = 1;
    FragmentPacket fragment_packet  = 2;
    ManifestPacket manifest_packet  = 3;
  }
}

message NoDataPacket {}

// FragmentPacket defines a single chunk of file data
message FragmentPacket {
  uint64 id   = 1;
  bytes  data = 2;
}

// PacketFragmentMapping defines the location of a fragment
message PacketFragmentMapping {
  string fdsc_id     = 1;
  string fragment_id = 2;
}

// FileMetadata defines metadata for a single file within the project
message FileMetadata {
  string mime_type = 1;
  uint64 size      = 2;
  // このファイル構成するフラグメントの順序付きリスト
  repeated PacketFragmentMapping fragments = 3;
}

// ManifestPacket defines the structure of the website/project
// ルートからのパスをキーとしたマップ構造で、ファイルメタデータへのO(1)アクセスを実現します
message ManifestPacket {
  string project_name = 1;
  string version      = 2;
  // マップのキーは相対パス (例: "index.html", "assets/logo.png")
  map<string, FileMetadata> files = 3;
}